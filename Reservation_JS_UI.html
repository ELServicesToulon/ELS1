<script>
/**
 * =================================================================
 * MODULE JAVASCRIPT - INTERFACE UTILISATEUR (UI)
 * =================================================================
 * Description: Gère les composants d'interface utilisateur génériques 
 * comme les notifications, les messages d'erreur et 
 * l'indicateur de chargement.
 */

/**
 * Affiche une notification animée à l'écran.
 * @param {string} message Le message à afficher.
 * @param {string} [type="info"] Le type de notification ('info', 'succes', 'erreur').
 */
function afficherNotification(message, type = "info") {
  const conteneur = document.getElementById('conteneur-notifications');
  if (!conteneur) {
    console.error("Le conteneur de notifications est introuvable.");
    return;
  }
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = message;
  conteneur.appendChild(notification);
  
  // La notification disparaît automatiquement après 5 secondes.
  setTimeout(() => {
    notification.remove();
  }, 5000);
}

/**
 * Affiche ou masque l'indicateur de chargement global (spinner).
 * @param {boolean} afficher True pour afficher, false pour masquer.
 */
function basculerIndicateurChargement(afficher) {
  const indicateur = document.getElementById('indicateur-chargement');
  if (indicateur) {
    indicateur.classList.toggle('hidden', !afficher);
  } else {
    console.warn("L'élément 'indicateur-chargement' est introuvable dans le DOM.");
  }
}

/**
 * Gère l'affichage d'une erreur à l'utilisateur et dans la console.
 * @param {Object|string} erreur L'objet d'erreur ou le message à afficher.
 */
function afficherErreur(erreur) {
  basculerIndicateurChargement(false); // Toujours masquer le chargement en cas d'erreur.
  const messageErreur = typeof erreur === 'object' && erreur.message ? erreur.message : String(erreur);
  afficherNotification(`Erreur : ${messageErreur}`, "erreur");
  console.error(erreur);
}

/**
 * Affiche les créneaux horaires dans la modale, en désactivant ceux qui sont passés.
 * @param {string[]} creneauxDisponibles Tableau des créneaux disponibles (ex: ["09h00", "09h15"]).
 */
function afficherCreneaux(creneauxDisponibles) {
    const { grilleSelectionCreneau } = window.ui;
    const { dateSelectionnee } = window.etat; // Format attendu: "YYYY-MM-DD"

    if (!grilleSelectionCreneau || !dateSelectionnee) {
        console.error("Impossible d'afficher les créneaux : élément UI ou date manquants.");
        afficherErreur("Une erreur technique est survenue lors de l'affichage des créneaux.");
        return;
    }

    grilleSelectionCreneau.innerHTML = '';
    const maintenant = new Date();

    if (!creneauxDisponibles || creneauxDisponibles.length === 0) {
        grilleSelectionCreneau.innerHTML = '<p class="aucun-creneau">Aucun créneau disponible pour cette journée.</p>';
        return;
    }

    const [annee, mois, jour] = dateSelectionnee.split('-').map(Number);

    creneauxDisponibles.forEach(heureStr => {
        const creneauEl = document.createElement('button');
        creneauEl.type = 'button';
        creneauEl.className = 'btn-creneau';
        creneauEl.textContent = heureStr.replace('h', ':');
        creneauEl.dataset.heure = heureStr;

        const [heures, minutes] = heureStr.split('h').map(Number);

        const dateCreneau = new Date(annee, mois - 1, jour, heures, minutes);

        if (dateCreneau < maintenant) {
            creneauEl.disabled = true;
            creneauEl.classList.add('desactive');
            creneauEl.title = 'Créneau expiré';
        }

        grilleSelectionCreneau.appendChild(creneauEl);
    });
}
</script>


